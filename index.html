<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>سوق العملات العشوائي</title>
<style>
  body {
    font-family: Arial, sans-serif;
    direction: rtl;
    padding: 20px;
    background: #f9f9f9;
  }
  h1 {
    margin-bottom: 20px;
  }
  .log {
    background: #fff;
    border: 1px solid #ccc;
    height: 300px;
    overflow-y: auto;
    padding: 10px;
    margin-top: 20px;
  }
</style>
</head>
<body>

<h1>سوق العملات العشوائي</h1>

<div>
  <strong>رصيد الزبون لكل عملة:</strong>
  <ul>
    <li>بتكوين (BTC): <span id="btcCount">0</span> قطعة</li>
    <li>داش (DASH): <span id="dashCount">0</span> قطعة</li>
    <li>نانو (NANO): <span id="nanoCount">0</span> قطعة</li>
  </ul>
</div>

<div class="log" id="log"></div>

<script>
  // إعدادات الزبون - الحد الأقصى لكل عملة
  const customerMax = {
    BTC: 5,
    DASH: 3,
    NANO: 7
  };

  // عدد القطع التي يملكها الزبون حالياً
  const customerHoldings = {
    BTC: 0,
    DASH: 0,
    NANO: 0
  };

  // العملات ووقت تنفيذ العملية (دقيقة كل 20)
  const coins = [
    { name: "BTC", minute: 0 },
    { name: "DASH", minute: 20 },
    { name: "NANO", minute: 40 }
  ];

  // عنصر اللوق لعرض الأحداث
  const logEl = document.getElementById("log");

  // تحديث عرض عدد القطع للزبون في الواجهة
  function updateDisplay() {
    document.getElementById("btcCount").textContent = customerHoldings.BTC;
    document.getElementById("dashCount").textContent = customerHoldings.DASH;
    document.getElementById("nanoCount").textContent = customerHoldings.NANO;
  }

  // وظيفة لكتابة لوق داخل div
  function log(msg) {
    const time = new Date().toLocaleTimeString();
    const p = document.createElement("p");
    p.textContent = `[${time}] ${msg}`;
    logEl.appendChild(p);
    logEl.scrollTop = logEl.scrollHeight;
  }

  // وظيفة عملية بيع أو شراء واحدة بشكل عشوائي للقطعة مع احترام الحد الأقصى
  function doTrade(coinName) {
    // عشوائي: 0 = بيع، 1 = شراء
    const action = Math.random() < 0.5 ? "بيع" : "شراء";

    if (action === "شراء") {
      // تحقق هل وصل الحد الأقصى؟
      if (customerHoldings[coinName] < customerMax[coinName]) {
        customerHoldings[coinName]++;
        log(`تم شراء قطعة واحدة من ${coinName}. (المجموع: ${customerHoldings[coinName]})`);
      } else {
        log(`الشراء من ${coinName} مرفوض! وصلت الحد الأقصى (${customerMax[coinName]} قطع).`);
      }
    } else {
      // بيع: فقط إذا لديه قطعة واحدة على الأقل ليبيعها
      if (customerHoldings[coinName] > 0) {
        customerHoldings[coinName]--;
        log(`تم بيع قطعة واحدة من ${coinName}. (المجموع: ${customerHoldings[coinName]})`);
      } else {
        log(`البيع من ${coinName} مرفوض! لا توجد قطع للبيع.`);
      }
    }

    updateDisplay();
  }

  // دالة تتحقق كل دقيقة هل الوقت مناسب لتنفيذ عملية على عملة معينة
  function checkAndTrade() {
    const now = new Date();
    const minute = now.getMinutes();
    const second = now.getSeconds();

    // ننفذ فقط في بداية الدقيقة (الثانية 0)
    if (second !== 0) return;

    for (const coin of coins) {
      if (minute === coin.minute) {
        doTrade(coin.name);
        break; // فقط عملة واحدة في الدقيقة المحددة
      }
    }
  }

  // تشغيل التحقق كل ثانية لمزيد دقة الوقت عند بداية الدقيقة
  setInterval(checkAndTrade, 1000);

  // عرض مبدئي
  updateDisplay();
  log("نظام التداول العشوائي بدأ. سيتم تنفيذ العمليات في الدقيقة 00 (BTC)، 20 (DASH)، 40 (NANO).");
</script>

</body>
</html>