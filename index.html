<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>محفظة GoldCrypto</title>
<style>
  body {
    background: linear-gradient(to bottom, #1e1e2f, #292945);
    color: #f5f5f5;
    font-family: "Cairo", sans-serif;
    text-align: center;
    padding: 20px;
  }
  h1 { color: #ffcc00; }
  .btn {
    padding: 10px 20px; margin: 5px;
    background: #ffcc00; color: #000;
    border: none; border-radius: 8px; cursor: pointer; font-weight: bold;
  }
  .btn:hover { background: #ffd633; }
  .section { display: none; margin-top: 20px; }
  .input { padding: 8px; margin: 5px; border-radius: 6px; border: none; text-align: center; }
  table {
    width: 80%; margin: 20px auto; border-collapse: collapse;
    background: #2f2f47; border-radius: 12px; overflow: hidden;
  }
  th, td { padding: 12px; border-bottom: 1px solid #444; }
  th { background-color: #ffcc00; color: #000; }
  #log, #clientLog { margin-top: 20px; max-height: 200px; overflow-y: auto; text-align: right; }
</style>
</head>
<body>
<h1>💰 محفظة GoldCrypto</h1>

<!-- اختيار نوع الدخول -->
<div id="mainMenu">
  <button class="btn" onclick="showSection('clientLogin')">👤 تسجيل دخول العميل</button>
  <button class="btn" onclick="adminAccess()">⚙️ دخول الإدارة</button>
</div>

<!-- تسجيل دخول العميل -->
<div id="clientLogin" class="section">
  <h2>تسجيل دخول العميل</h2>
  <input class="input" id="clientName" placeholder="اسم الحساب">
  <input class="input" id="clientCard" placeholder="كود البطاقة البنكية">
  <input type="password" class="input" id="clientPass" placeholder="كلمة المرور">
  <button class="btn" onclick="clientLogin()">دخول</button>
  <button class="btn" onclick="showSection('mainMenu')">🔙 رجوع</button>
</div>

<!-- واجهة العميل -->
<div id="clientDashboard" class="section">
  <h2>📊 محفظتي</h2>
  <div id="clientWallet"></div>
  <h3>📜 سجل عملياتي</h3>
  <div id="clientLog"></div>
  <button class="btn" onclick="clientReport()">📝 طلب التقرير</button>
  <button class="btn" onclick="logout()">🔙 خروج</button>
</div>

<!-- واجهة الإدارة -->
<div id="adminDashboard" class="section">
  <h2>⚙️ لوحة الإدارة</h2>
  <h3>➕ إنشاء محفظة</h3>
  <input class="input" id="newName" placeholder="اسم الحساب">
  <input class="input" id="newCard" placeholder="كود البطاقة البنكية">
  <input type="password" class="input" id="newPass" placeholder="كلمة المرور">
  <button class="btn" onclick="createWallet()">إنشاء</button>

  <h3>💱 تنفيذ عملية</h3>
  <select class="input" id="accountSelect"></select>
  <select class="input" id="cryptoSelect"></select>
  <select class="input" id="typeSelect">
    <option value="buy">شراء</option>
    <option value="sell">بيع</option>
  </select>
  <input type="number" class="input" id="amountInput" placeholder="الكمية">
  <button class="btn" onclick="addOperation()">تنفيذ العملية</button>

  <h3>📜 سجل العمليات</h3>
  <div id="log">لا توجد عمليات بعد.</div>
  <button class="btn" onclick="fullReport()">📝 تقرير شامل</button>
  <button class="btn" onclick="resetData()">♻️ إعادة تعيين</button>
  <button class="btn" onclick="logout()">🔙 خروج</button>
</div>

<script>
let cryptos = [
  {name: "Bitcoin (BTC)", price: 1000, dailyLimit: 1},
  {name: "DASH", price: 250, dailyLimit: 3},
  {name: "Tether (USDT)", price: 100, dailyLimit: 5},
  {name: "Monero (XMR)", price: 600, dailyLimit: 1},
  {name: "Nano (NANO)", price: 120, dailyLimit: 10},
  {name: "Litecoin (LTC)", price: 300, dailyLimit: 2},
];

let buyImpact = 0.20;
let sellImpact = 0.15;

let wallets = JSON.parse(localStorage.getItem('wallets') || '[]');
let operations = JSON.parse(localStorage.getItem('operations') || '[]');
let currentUser = null;

const cryptoSelect = document.getElementById('cryptoSelect');
cryptos.forEach((c,i)=>{
  let opt = document.createElement("option");
  opt.value = i;
  opt.textContent = `${c.name} (${c.price}G)`;
  cryptoSelect.appendChild(opt);
});

function saveData(){
  localStorage.setItem('wallets', JSON.stringify(wallets));
  localStorage.setItem('operations', JSON.stringify(operations));
}

function showSection(id){
  document.querySelectorAll('.section').forEach(s=>s.style.display='none');
  document.getElementById(id).style.display='block';
}

function adminAccess(){
  let pass = prompt("أدخل كلمة سر الإدارة:");
  if(pass === "TECNO LD7") showSection('adminDashboard');
  else alert("❌ كلمة السر خاطئة");
}

function createWallet(){
  let name = newName.value.trim();
  let card = newCard.value.trim();
  let pass = newPass.value.trim();
  if(!name||!card||!pass){alert("❌ أدخل كل البيانات");return;}
  if(wallets.find(w=>w.card===card)){alert("❌ البطاقة مسجلة مسبقاً");return;}
  let code = "Z"+wallets.length.toString().padStart(3,"0")+"Z";
  let wallet = {name, card, pass, code, coins:{}, bought:{}, sold:{}, logs:[]};
  cryptos.forEach(c=>{wallet.coins[c.name]=0;wallet.bought[c.name]=0;wallet.sold[c.name]=0;});
  wallets.push(wallet); saveData(); alert("✅ تم إنشاء المحفظة وكودها: "+code);
  updateAccountSelect();
}

function updateAccountSelect(){
  accountSelect.innerHTML="";
  wallets.forEach((w,i)=>{
    let opt=document.createElement("option");
    opt.value=i; opt.textContent=`${w.name} (${w.code})`;
    accountSelect.appendChild(opt);
  });
}
updateAccountSelect();

function addOperation(){
  let wi = +accountSelect.value;
  let ci = +cryptoSelect.value;
  let type = typeSelect.value;
  let amount = +amountInput.value;
  if(amount<=0){alert("❌ أدخل كمية صحيحة");return;}
  let w = wallets[wi]; let c = cryptos[ci];

  if(type==='buy'){
    if(w.bought[c.name]+amount > c.dailyLimit){
      alert("❌ تجاوز الحد اليومي لهذه العملة"); return;
    }
    let totalPrice = c.price * amount;
    w.coins[c.name]+=amount; w.bought[c.name]+=amount;
    let log=`✅ ${w.name} اشترى ${amount} ${c.name} بسعر ${totalPrice.toFixed(2)}G`;
    w.logs.push(log); operations.push(log);
    c.price *= (1+buyImpact)**amount;
  } else {
    if(w.coins[c.name]<amount){alert("❌ رصيد غير كافٍ");return;}
    let totalPrice = c.price * amount;
    w.coins[c.name]-=amount; w.sold[c.name]+=amount;
    let log=`💱 ${w.name} باع ${amount} ${c.name} بسعر ${totalPrice.toFixed(2)}G`;
    w.logs.push(log); operations.push(log);
    c.price *= (1-sellImpact)**amount;
  }

  log.innerHTML = operations.map(o=>`• ${o}`).join("<br>");
  saveData(); renderClient(); renderAdminTable();
}

function renderClient(){
  if(!currentUser) return;
  let w = wallets.find(x=>x.code===currentUser);
  if(!w) return;
  clientWallet.innerHTML = "<table><tr><th>العملة</th><th>الرصيد</th></tr>"+Object.keys(w.coins).map(k=>`<tr><td>${k}</td><td>${w.coins[k]}</td></tr>`).join("")+"</table>";
  clientLog.innerHTML = w.logs.length?w.logs.join("<br>"):"لا توجد عمليات بعد";
}

function clientLogin(){
  let name=clientName.value.trim(), card=clientCard.value.trim(), pass=clientPass.value.trim();
  let w = wallets.find(x=>x.name===name && x.card===card && x.pass===pass);
  if(!w){alert("❌ بيانات الدخول خاطئة");return;}
  currentUser=w.code; showSection('clientDashboard'); renderClient();
}

function clientReport(){
  let w = wallets.find(x=>x.code===currentUser);
  alert(`📊 تقرير حسابك:\n${w.logs.join("\n")}`);
}

function fullReport(){
  let report = "📊 تقرير شامل:\n\n"+operations.join("\n");
  alert(report||"لا توجد عمليات");
}

function resetData(){
  if(confirm("هل أنت متأكد من إعادة التعيين؟")){
    wallets=[]; operations=[]; cryptos.forEach(c=>c.price=c.price);
    saveData(); updateAccountSelect(); log.innerHTML="تم إعادة التعيين";
  }
}

function logout(){
  currentUser=null; showSection('mainMenu');
}

function renderAdminTable(){
  cryptoSelect.innerHTML="";
  cryptos.forEach((c,i)=>{
    let opt=document.createElement("option");
    opt.value=i; opt.textContent=`${c.name} (${c.price.toFixed(2)}G)`;
    cryptoSelect.appendChild(opt);
  });
}

renderAdminTable();
log.innerHTML = operations.length?operations.map(o=>`• ${o}`).join("<br>"):"لا توجد عمليات بعد";
</script>
</body>
</html>